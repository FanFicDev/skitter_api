<!DOCTYPE html>
<html lang=en>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>skitter.fanfic.dev</title>
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Karla&family=Source+Code+Pro&display=swap" rel="stylesheet">
		<link rel="stylesheet" href="style.css">
	</head>
	<body>
		<main>
			<h1>skitter.fanfic.dev</h1>
			<h3>
				Depending on which domain the service is accessed through, there may
				or may not be a <code>/skitter</code> prefix to these endpoints.
			</h3>
			<ul>
				<li>
					<p>
						<code>/skitter/v0/status</code>: Returns the status of the
						service. If everything is well <code>err</code> should be
						<code>0</code> and <code>status</code> should be
						<code>"ok"</code>. Ex:
					</p>
					<blockquote>
						{"err":0,"pid":1539142,"status":"ok","tident":139839177664384}
					</blockquote>
				</li>
				<li>
					<p>
						<code>/skitter/v0/cache?q={url}&amp;apiKey={key}</code>:
						Return the most recent cached version of a url if it is in the cache.
						Returns a <code>status 404</code> response if no matching
						cache entry is found.
					</p>
				</li>
				<li>
					<p>
						<code>/skitter/v0/crawl?q={url}&amp;apiKey={key}</code>: Crawl a
						specific url. It is an error to pass a url that does not start with
						<code>https?://</code>.
					</p>
				</li>
			</ul>
			<p>
				Endpoints with a non-optional <code>apiKey</code> parameter
				require a valid <code>apiKey</code> to work. It is recommended
				to pass the <code>apiKey</code> in the request body.
			</p>
			<p>
				In general, if a response has a negative <code>err</code> code
				in a json body then there was an error issued by the api codebase. If
				there is a positive <code>err</code> code in a json body, then
				the error was issued by the application framework or web server and
				the numeric value will match the http status code.
				<ul>
					<li>
						<p>
							<code>status 200</code>: body is simply proxied body. A few
							informative headers starting with <code>X-Weaver-</code> are
							included to identify the cached request and actually queried url.
							Upstream response headers are not included.
						</p>
					</li>
					<li>
						<p>
							<code>status 400</code>: bad query, either missing the
							<code>q</code> query param or it is not a supported url. A json
							response body will be included, ex:
						</p>
						<blockquote>{"err":-1,"msg":"missing q param"}</blockquote>
						<blockquote>{"arg":"foo","err":-2,"msg":"url is not ffn"}</blockquote>
					</li>
					<li>
						<p>
							<code>status 401</code>: unauthorized, ensure any required
							basic auth parameters are being passed. Ex:
						</p>
						<blockquote>{"err":401,"msg":"Unauthorized","nginx":true}</blockquote>
					</li>
					<li>
						<p>
							<code>status 404</code>: file not found, ensure the url is a
							valid api endpoint. Ex:
						</p>
						<blockquote>{"err":-404,"msg":"not found"}</blockquote>
					</li>
					<li>
						<p>
							<code>status 429</code>: too many requests; a
							<code>Retry-After</code> header will be included with minimum
							integer number of seconds before the client should make another
							request. A json response body with the same field will be included,
							ex:
						</p>
						<blockquote>{"err":-429,"msg":"too many requests","retryAfter":5}</blockquote>
					</li>
					<li>
						<p>
							<code>status 500</code>: internal server error. Either weaver
							is misconfigured, or there's an outage somewhere in the pipeline
							(possibly all FR instances are busy or down).
						</p>
					</li>
				</ul>
			</p>
		</main>
	</body>
</html>
